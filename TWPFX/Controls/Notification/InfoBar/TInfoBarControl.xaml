<UserControl
    x:Class="TWPFX.Controls.Notification.InfoBar.TInfoBarControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:TWPFX.Controls.Notification.InfoBar"
    xmlns:lottie="clr-namespace:LottieSharp.WPF;assembly=LottieSharp"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DataContext="{d:DesignInstance local:TInfoBarControl,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <!--  内联样式定义  -->
        <Style x:Key="InternalCloseButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="26" />
            <Setter Property="Height" Value="26" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="VerticalAlignment" Value="TOP" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <!--  按钮背景  -->
                            <Rectangle
                                x:Name="Background"
                                Fill="{TemplateBinding Background}"
                                RadiusX="4"
                                RadiusY="4" />
                            <!--  关闭图标  -->
                            <Path
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Data="M0,0 L10,10 M0,10 L10,0"
                                Stroke="#888"
                                StrokeEndLineCap="Round"
                                StrokeStartLineCap="Round"
                                StrokeThickness="1.5" />
                        </Grid>

                        <!--  定义按钮状态的触发器  -->
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Background" Property="Fill" Value="#1A000000" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Background" Property="Fill" Value="#1A000000" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  缓动函数  -->
        <SineEase x:Key="SineEaseInOut" EasingMode="EaseInOut" />

        <!--  淡出动画（透明度消失）  -->
        <Storyboard x:Key="FadeOutStoryboard">
            <DoubleAnimation
                EasingFunction="{StaticResource SineEaseInOut}"
                Storyboard.TargetProperty="Opacity"
                From="1"
                To="0"
                Duration="0:0:0.3" />
        </Storyboard>
        <DropShadowEffect
            x:Key="InfoBarShadowEffect"
            BlurRadius="12"
            Opacity="0.25"
            ShadowDepth="2"
            Color="#40000000" />
    </UserControl.Resources>
    <Border
        x:Name="RootBorder"
        MaxWidth="310"
        Margin="0,6"
        Padding="10"
        Background="{Binding BackgroundColor}"
        BorderBrush="#e8e8e8"
        BorderThickness="1"
        CornerRadius="5"
        Loaded="UserControl_Loaded"
        RenderTransformOrigin="0.5,0.5">
        <Border.Style>
            <Style TargetType="Border">
                <Setter Property="Effect" Value="{x:Null}" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsShadowEnabled}" Value="True">
                        <Setter Property="Effect" Value="{StaticResource InfoBarShadowEffect}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Border.Style>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <lottie:LottieAnimationView
                Grid.Row="0"
                Grid.Column="0"
                Width="26"
                Height="26"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                AutoPlay="{Binding AutoPlay}"
                RepeatCount="{Binding RepeatCount}"
                ResourcePath="{Binding ResourcePath}" />
            <StackPanel
                Grid.Row="0"
                Grid.Column="1"
                Margin="12,0,0,0"
                Orientation="{Binding Orientation}">
                <TextBlock
                    Margin="0,3,9,3"
                    VerticalAlignment="Center"
                    FontFamily="Segoe UI, Microsoft YaHei, SimSun, sans-serif"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Foreground="Black"
                    Text="{Binding Title}"
                    TextWrapping="Wrap" />
                <TextBlock
                    x:Name="textBlock_content"
                    VerticalAlignment="Center"
                    FontFamily="Segoe UI, Microsoft YaHei, SimSun, sans-serif"
                    FontSize="14"
                    Foreground="#262626"
                    Text="{Binding InfoContent}"
                    TextWrapping="Wrap" />
            </StackPanel>
            <Button
                Grid.Row="0"
                Grid.Column="2"
                VerticalAlignment="Top"
                Click="CloseButton_Click"
                Style="{StaticResource InternalCloseButtonStyle}" />
            <StackPanel
                x:Name="panel"
                Grid.Row="1"
                Grid.Column="2" />
        </Grid>
    </Border>
</UserControl>
